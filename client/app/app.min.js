/*! courageous-trapeze 2015-05-09 */
angular.module("courageousTrapeze.factories",[]).factory("AttachTokens",["$window",function(a){var b={request:function(b){var c=a.localStorage.getItem("courageousTrapeze");return c&&(b.headers["x-access-token"]=c),b}};return b}]).factory("Auth",["$http","$location","$window",function(a,b,c){var d=function(b){return a({method:"POST",url:"/api/users/signin",data:b})},e=function(b){return a({method:"POST",url:"/api/users/signup",data:b})},f=function(){return!!c.localStorage.getItem("courageousTrapeze")},g=function(){c.localStorage.removeItem("courageousTrapeze"),b.path("/signin")};return{signin:d,signup:e,isAuth:f,signout:g}}]).factory("Contacts",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/contacts"}).then(function(a){return a.data})},c=function(b){return a({method:"POST",url:"/api/contacts",data:b})};return{getAll:b,addContact:c}}]).factory("Messages",["$http",function(a){var b=function(){return a({method:"GET",url:"/api/messages"}).then(function(a){return a.data})},c=function(b){return a({method:"POST",url:"/api/messages",data:b})};return{getAll:b,addMessage:c}}]),angular.module("courageousTrapeze.contacts",[]).controller("ContactsController",["$scope","Contacts",function(a,b){}]),angular.module("courageousTrapeze.messages",[]).controller("MessagesController",["$scope","Messages",function(a,b){b.getAll()}]),angular.module("courageousTrapeze.schedule",[]).controller("ScheduleController",["$scope",function(a){}]),angular.module("courageousTrapeze.auth",[]).controller("AuthController",["$scope","$location","Auth",function(a,b,c){a.user={},a.signin=function(){c.signin(a.user).success(function(a){window.localStorage.setItem("courageousTrapeze",a.token),b.path("/messages")}).error(function(a){console.error(a)})},a.signup=function(){c.signup(a.user).success(function(a){window.localStorage.setItem("courageousTrapeze",a.token),b.path("/messages")}).error(function(a){console.error(a)})},a.signout=function(){c.signout()},a.isAuth=function(){return c.isAuth()}}]),angular.module("courageousTrapeze",["courageousTrapeze.factories","courageousTrapeze.contacts","courageousTrapeze.schedule","courageousTrapeze.messages","courageousTrapeze.auth","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/signin",{templateUrl:"app/auth/signin.html",controller:"AuthController"}).when("/signup",{templateUrl:"app/auth/signup.html",controller:"AuthController"}).when("/contacts",{templateUrl:"app/contacts/contacts.html",controller:"ContactsController",authenticate:!0}).when("/schedule",{templateUrl:"app/schedule/schedule.html",controller:"ScheduleController",authenticate:!0}).when("/messages",{templateUrl:"app/messages/messages.html",controller:"MessagesController",authenticate:!0}).otherwise({redirectTo:"/messages"}),b.interceptors.push("AttachTokens")}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$routeChangeStart",function(a,d){d.$$route&&d.$$route.authenticate&&!c.isAuth()&&b.path("/signin")})}]);